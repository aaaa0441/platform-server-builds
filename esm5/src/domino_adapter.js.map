{"version":3,"file":"domino_adapter.js","sourceRoot":"","sources":["../../../../../packages/platform-server/src/domino_adapter.ts"],"names":[],"mappings":";;;;;;;;;;;;AAOA,qBAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAEjC,OAAO,EAAC,kBAAkB,IAAI,iBAAiB,EAAE,kBAAkB,IAAI,iBAAiB,EAAC,MAAM,2BAA2B,CAAC;;;;;AAE3H,yBAAyB,UAAkB;IACzC,MAAM,CAAC,IAAI,KAAK,CAAC,mDAAmD,GAAG,UAAU,CAAC,CAAC;CACpF;;;;;;;AAKD,MAAM,wBAAwB,IAAY,EAAE,GAAS;IAAT,oBAAA,EAAA,SAAS;IACnD,qBAAI,MAAM,GAAG,MAAM,CAAC,YAAY,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;IAC5C,qBAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC;IAC1B,MAAM,CAAC,GAAG,CAAC;CACZ;;;;;;AAKD,MAAM,4BAA4B,GAAa;IAC7C,MAAM,CAAC,mBAAC,GAAU,EAAC,CAAC,SAAS,EAAE,CAAC;CACjC;;;;AAKD;;;AAAA;IAAmC,yCAAiB;;;;;;;IAC3C,yBAAW;;;IAAlB,cAAuB,iBAAiB,CAAC,IAAI,aAAa,EAAE,CAAC,CAAC,EAAE;;;;;IAIhE,gCAAQ;;;;IAAR,UAAS,KAAa,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;;;;;IAEjD,2BAAG;;;;IAAH,UAAI,KAAa;;QAEf,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KACpB;;;;;IAED,gCAAQ;;;;IAAR,UAAS,KAAa,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;;;;IAEjD,mCAAW;;;IAAX,eAAgB;;;;IAEhB,yCAAiB;;;IAAjB,cAA+B,MAAM,CAAC,KAAK,CAAC,EAAE;;;;IAC9C,+CAAuB;;;IAAvB,cAAqC,MAAM,CAAC,KAAK,CAAC,EAAE;;;;;;IAEpD,gCAAQ;;;;;IAAR,UAAS,KAAU,EAAE,KAAU;QAC7B,qBAAI,KAAK,GAAG,KAAK,CAAC;QAClB,OAAO,KAAK,EAAE,CAAC;YACb,EAAE,CAAC,CAAC,KAAK,KAAK,KAAK,CAAC;gBAAC,MAAM,CAAC,IAAI,CAAC;YACjC,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC;SACtB;QACD,MAAM,CAAC,KAAK,CAAC;KACd;;;;IAED,0CAAkB;;;IAAlB;QACE,MAAM,CAAC,aAAa,CAAC,iEAAiE,CAAC,CAAC;KACzF;;;;IAED,0CAAkB;;;IAAlB;QACE,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC;YAC9B,aAAa,CAAC,UAAU,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;SACpD;QACD,MAAM,CAAC,aAAa,CAAC,UAAU,CAAC;KACjC;;;;;;IAED,wCAAgB;;;;;IAAhB,UAAiB,EAAO,EAAE,GAAwB;QAAxB,oBAAA,EAAA,cAAwB;QAChD,EAAE,CAAC,UAAU,GAAG,GAAG,CAAC,sBAAsB,EAAE,CAAC;QAC7C,EAAE,CAAC,UAAU,CAAC,MAAM,GAAG,EAAE,CAAC;QAC1B,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC;KACtB;;;;;IACD,qCAAa;;;;IAAb,UAAc,EAAO,IAAsB,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE;;;;;IAElE,kCAAU;;;;IAAV,UAAW,IAAS,IAAa,MAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,aAAa,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;;;;;IAC/F,qCAAa;;;;IAAb,UAAc,IAAS;QACrB,MAAM,CAAC,IAAI,CAAC,QAAQ,KAAK,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC;KAChE;;;;;IACD,qCAAa;;;;IAAb,UAAc,IAAS;QACrB,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,KAAK,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC;KAC/E;;;;;IACD,qCAAa;;;;IAAb,UAAc,IAAS,IAAa,MAAM,CAAC,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,EAAE;;;;;IACrE,oCAAY;;;;IAAZ,UAAa,IAAS,IAAa,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,EAAE;;;;;;IAE7E,mCAAW;;;;;IAAX,UAAY,EAAW,EAAE,IAAY;QACnC,EAAE,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC;;;YAGpB,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;SACtC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC;;YAEhC,MAAM,CAAC,EAAE,CAAC,WAAW,CAAC;SACvB;QACD,MAAM,CAAC,mBAAM,EAAE,EAAC,CAAC,IAAI,CAAC,CAAC;KACxB;;;;;;;IAED,mCAAW;;;;;;IAAX,UAAY,EAAW,EAAE,IAAY,EAAE,KAAU;QAC/C,EAAE,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC;;;YAGpB,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;SACtC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC;;YAEhC,EAAE,CAAC,WAAW,GAAG,KAAK,CAAC;SACxB;QACD,mBAAM,EAAE,EAAC,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;KACzB;;;;;;IAED,4CAAoB;;;;;IAApB,UAAqB,GAAa,EAAE,MAAc;QAChD,EAAE,CAAC,CAAC,MAAM,KAAK,QAAQ,CAAC,CAAC,CAAC;YACxB,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC;SACxB;QACD,EAAE,CAAC,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC,CAAC;YAC1B,MAAM,CAAC,GAAG,CAAC;SACZ;QACD,EAAE,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,CAAC,CAAC;YACtB,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC;SACjB;QACD,MAAM,CAAC,IAAI,CAAC;KACb;;;;;IAED,mCAAW;;;;IAAX,UAAY,GAAa;QACvB,qBAAM,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC,CAAC;QAC7D,qBAAI,IAAI,GAAG,EAAE,CAAC;QACd,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACT,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAC3B;;QAED,MAAM,CAAC,IAAI,CAAC;KACb;IAED,gBAAgB;;;;;;IAChB,2CAAmB;;;;;IAAnB,UAAoB,OAAY;QAC9B,qBAAM,QAAQ,GAA6B,EAAE,CAAC;QAC9C,qBAAM,cAAc,GAAG,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QACrD,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;YACnB,qBAAM,SAAS,GAAG,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9C,GAAG,CAAC,CAAC,qBAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAC1C,qBAAM,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;gBAClC,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;oBACrB,qBAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;oBACtC,EAAE,CAAC,CAAC,UAAU,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;wBACtB,MAAM,IAAI,KAAK,CAAC,wBAAsB,KAAO,CAAC,CAAC;qBAChD;oBACD,qBAAM,MAAI,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,IAAI,EAAE,CAAC;oBAChD,QAAQ,CAAC,MAAI,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;iBACtD;aACF;SACF;QACD,MAAM,CAAC,QAAQ,CAAC;KACjB;IACD,gBAAgB;;;;;;;IAChB,4CAAoB;;;;;;IAApB,UAAqB,OAAY,EAAE,QAAkC;QACnE,qBAAI,cAAc,GAAG,EAAE,CAAC;QACxB,GAAG,CAAC,CAAC,qBAAM,GAAG,IAAI,QAAQ,CAAC,CAAC,CAAC;YAC3B,qBAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC/B,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACb,cAAc,IAAI,GAAG,GAAG,GAAG,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;aACnD;SACF;QACD,OAAO,CAAC,YAAY,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;KAC/C;;;;;;;IACD,gCAAQ;;;;;;IAAR,UAAS,OAAY,EAAE,SAAiB,EAAE,UAAwB;QAChE,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;QACxE,qBAAM,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;QACnD,QAAQ,CAAC,SAAS,CAAC,GAAG,UAAU,IAAI,EAAE,CAAC;QACvC,IAAI,CAAC,oBAAoB,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;KAC9C;;;;;;IACD,mCAAW;;;;;IAAX,UAAY,OAAY,EAAE,SAAiB;;;QAGzC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,SAAS,EAAE,EAAE,CAAC,CAAC;KACvC;;;;;;IACD,gCAAQ;;;;;IAAR,UAAS,OAAY,EAAE,SAAiB;QACtC,qBAAM,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;QACnD,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;KAClC;;;;;;;IACD,gCAAQ;;;;;;IAAR,UAAS,OAAY,EAAE,SAAiB,EAAE,UAAmB;QAC3D,qBAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QAChD,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,KAAK,IAAI,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;KAC5D;;;;;;IAED,qCAAa;;;;;IAAb,UAAc,EAAQ,EAAE,GAAQ;QAC9B,EAAE,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;;QAGtB,qBAAM,GAAG,GAAG,EAAE,CAAC,aAAa,IAAI,EAAE,CAAC;QACnC,qBAAM,GAAG,GAAG,mBAAC,GAAU,EAAC,CAAC,WAAW,CAAC;QACrC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACR,GAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;SACxB;KACF;;;;IAED,kCAAU;;;IAAV,cAAwB,MAAM,eAAe,CAAC,YAAY,CAAC,CAAC,EAAE;;;;IAC9D,mCAAW;;;IAAX,cAA0B,MAAM,eAAe,CAAC,aAAa,CAAC,CAAC,EAAE;;;;IACjE,oCAAY;;;IAAZ,cAAyB,MAAM,CAAC,iBAAiB,CAAC,EAAE;;;;IAEpD,4CAAoB;;;IAApB,cAAkC,MAAM,CAAC,KAAK,CAAC,EAAE;;;;IACjD,sCAAc;;;IAAd,cAA2B,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,EAAE;;;;IAC/C,0CAAkB;;;IAAlB,cAA+B,MAAM,CAAC,EAAE,CAAC,EAAE;;;;IAC3C,wCAAgB;;;IAAhB,cAA6B,MAAM,CAAC,eAAe,CAAC,EAAE;;;;IACtD,yCAAiB;;;IAAjB,cAA+B,MAAM,CAAC,IAAI,CAAC,EAAE;;;;;IAE7C,2CAAmB;;;;IAAnB,UAAoB,EAAO,IAAY,MAAM,eAAe,CAAC,qBAAqB,CAAC,CAAC,EAAE;;;;IAEtF,uCAAe;;;IAAf,cAA6B,MAAM,CAAC,KAAK,CAAC,EAAE;;;;;IAC5C,iCAAS;;;;IAAT,UAAU,IAAY,IAAY,MAAM,eAAe,CAAC,WAAW,CAAC,CAAC,EAAE;;;;;;IACvE,iCAAS;;;;;IAAT,UAAU,IAAY,EAAE,KAAa,IAAI,MAAM,eAAe,CAAC,WAAW,CAAC,CAAC,EAAE;wBArNhF;EAkCmC,iBAAiB,EAoLnD,CAAA;;;;AApLD,yBAoLC","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nconst domino = require('domino');\n\nimport {ɵBrowserDomAdapter as BrowserDomAdapter, ɵsetRootDomAdapter as setRootDomAdapter} from '@angular/platform-browser';\n\nfunction _notImplemented(methodName: string) {\n  return new Error('This method is not implemented in DominoAdapter: ' + methodName);\n}\n\n/**\n * Parses a document string to a Document object.\n */\nexport function parseDocument(html: string, url = '/') {\n  let window = domino.createWindow(html, url);\n  let doc = window.document;\n  return doc;\n}\n\n/**\n * Serializes a document to string.\n */\nexport function serializeDocument(doc: Document): string {\n  return (doc as any).serialize();\n}\n\n/**\n * DOM Adapter for the server platform based on https://github.com/fgnass/domino.\n */\nexport class DominoAdapter extends BrowserDomAdapter {\n  static makeCurrent() { setRootDomAdapter(new DominoAdapter()); }\n\n  private static defaultDoc: Document;\n\n  logError(error: string) { console.error(error); }\n\n  log(error: string) {\n    // tslint:disable-next-line:no-console\n    console.log(error);\n  }\n\n  logGroup(error: string) { console.error(error); }\n\n  logGroupEnd() {}\n\n  supportsDOMEvents(): boolean { return false; }\n  supportsNativeShadowDOM(): boolean { return false; }\n\n  contains(nodeA: any, nodeB: any): boolean {\n    let inner = nodeB;\n    while (inner) {\n      if (inner === nodeA) return true;\n      inner = inner.parent;\n    }\n    return false;\n  }\n\n  createHtmlDocument(): HTMLDocument {\n    return parseDocument('<html><head><title>fakeTitle</title></head><body></body></html>');\n  }\n\n  getDefaultDocument(): Document {\n    if (!DominoAdapter.defaultDoc) {\n      DominoAdapter.defaultDoc = domino.createDocument();\n    }\n    return DominoAdapter.defaultDoc;\n  }\n\n  createShadowRoot(el: any, doc: Document = document): DocumentFragment {\n    el.shadowRoot = doc.createDocumentFragment();\n    el.shadowRoot.parent = el;\n    return el.shadowRoot;\n  }\n  getShadowRoot(el: any): DocumentFragment { return el.shadowRoot; }\n\n  isTextNode(node: any): boolean { return node.nodeType === DominoAdapter.defaultDoc.TEXT_NODE; }\n  isCommentNode(node: any): boolean {\n    return node.nodeType === DominoAdapter.defaultDoc.COMMENT_NODE;\n  }\n  isElementNode(node: any): boolean {\n    return node ? node.nodeType === DominoAdapter.defaultDoc.ELEMENT_NODE : false;\n  }\n  hasShadowRoot(node: any): boolean { return node.shadowRoot != null; }\n  isShadowRoot(node: any): boolean { return this.getShadowRoot(node) == node; }\n\n  getProperty(el: Element, name: string): any {\n    if (name === 'href') {\n      // Domino tries tp resolve href-s which we do not want. Just return the\n      // attribute value.\n      return this.getAttribute(el, 'href');\n    } else if (name === 'innerText') {\n      // Domino does not support innerText. Just map it to textContent.\n      return el.textContent;\n    }\n    return (<any>el)[name];\n  }\n\n  setProperty(el: Element, name: string, value: any) {\n    if (name === 'href') {\n      // Even though the server renderer reflects any properties to attributes\n      // map 'href' to attribute just to handle when setProperty is directly called.\n      this.setAttribute(el, 'href', value);\n    } else if (name === 'innerText') {\n      // Domino does not support innerText. Just map it to textContent.\n      el.textContent = value;\n    }\n    (<any>el)[name] = value;\n  }\n\n  getGlobalEventTarget(doc: Document, target: string): EventTarget|null {\n    if (target === 'window') {\n      return doc.defaultView;\n    }\n    if (target === 'document') {\n      return doc;\n    }\n    if (target === 'body') {\n      return doc.body;\n    }\n    return null;\n  }\n\n  getBaseHref(doc: Document): string {\n    const base = this.querySelector(doc.documentElement, 'base');\n    let href = '';\n    if (base) {\n      href = this.getHref(base);\n    }\n    // TODO(alxhub): Need relative path logic from BrowserDomAdapter here?\n    return href;\n  }\n\n  /** @internal */\n  _readStyleAttribute(element: any): {[name: string]: string} {\n    const styleMap: {[name: string]: string} = {};\n    const styleAttribute = element.getAttribute('style');\n    if (styleAttribute) {\n      const styleList = styleAttribute.split(/;+/g);\n      for (let i = 0; i < styleList.length; i++) {\n        const style = styleList[i].trim();\n        if (style.length > 0) {\n          const colonIndex = style.indexOf(':');\n          if (colonIndex === -1) {\n            throw new Error(`Invalid CSS style: ${style}`);\n          }\n          const name = style.substr(0, colonIndex).trim();\n          styleMap[name] = style.substr(colonIndex + 1).trim();\n        }\n      }\n    }\n    return styleMap;\n  }\n  /** @internal */\n  _writeStyleAttribute(element: any, styleMap: {[name: string]: string}) {\n    let styleAttrValue = '';\n    for (const key in styleMap) {\n      const newValue = styleMap[key];\n      if (newValue) {\n        styleAttrValue += key + ':' + styleMap[key] + ';';\n      }\n    }\n    element.setAttribute('style', styleAttrValue);\n  }\n  setStyle(element: any, styleName: string, styleValue?: string|null) {\n    styleName = styleName.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n    const styleMap = this._readStyleAttribute(element);\n    styleMap[styleName] = styleValue || '';\n    this._writeStyleAttribute(element, styleMap);\n  }\n  removeStyle(element: any, styleName: string) {\n    // IE requires '' instead of null\n    // see https://github.com/angular/angular/issues/7916\n    this.setStyle(element, styleName, '');\n  }\n  getStyle(element: any, styleName: string): string {\n    const styleMap = this._readStyleAttribute(element);\n    return styleMap[styleName] || '';\n  }\n  hasStyle(element: any, styleName: string, styleValue?: string): boolean {\n    const value = this.getStyle(element, styleName);\n    return styleValue ? value == styleValue : value.length > 0;\n  }\n\n  dispatchEvent(el: Node, evt: any) {\n    el.dispatchEvent(evt);\n\n    // Dispatch the event to the window also.\n    const doc = el.ownerDocument || el;\n    const win = (doc as any).defaultView;\n    if (win) {\n      win.dispatchEvent(evt);\n    }\n  }\n\n  getHistory(): History { throw _notImplemented('getHistory'); }\n  getLocation(): Location { throw _notImplemented('getLocation'); }\n  getUserAgent(): string { return 'Fake user agent'; }\n\n  supportsWebAnimation(): boolean { return false; }\n  performanceNow(): number { return Date.now(); }\n  getAnimationPrefix(): string { return ''; }\n  getTransitionEnd(): string { return 'transitionend'; }\n  supportsAnimation(): boolean { return true; }\n\n  getDistributedNodes(el: any): Node[] { throw _notImplemented('getDistributedNodes'); }\n\n  supportsCookies(): boolean { return false; }\n  getCookie(name: string): string { throw _notImplemented('getCookie'); }\n  setCookie(name: string, value: string) { throw _notImplemented('setCookie'); }\n}\n"]}